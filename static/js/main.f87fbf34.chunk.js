(this["webpackJsonptarot-score"]=this["webpackJsonptarot-score"]||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(23),s=n.n(c),o=(n(33),n(6)),i=n(7),u=n(9),d=n(8),l=n(13),h=n(3),m=(n(34),n(24)),f=n(2),p=n.n(f),j=n(5),b=[{name:"games",config:{keyPath:"id",autoIncrement:!0},indexes:["name","created","modified"]},{name:"game_players",config:{keyPath:"id",autoIncrement:!0},indexes:["game"]},{name:"rounds",config:{keyPath:"id",autoIncrement:!0},indexes:["game"]}],v=function(){function e(t){Object(o.a)(this,e),this.idb=void 0,this.idb=t}return Object(i.a)(e,[{key:"listGames",value:function(){var e=this.idb.transaction(["games"],"readonly").objectStore("games");return new Promise((function(t,n){var a=[];e.index("created").openCursor().onsuccess=function(e){var n=e.target.result;n?(a.push(n.value),n.continue()):t(a)}}))}},{key:"_getGame",value:function(e,t){var n=e.objectStore("games");return new Promise((function(e,a){n.get(t).onsuccess=function(t){var n=t.target.result;e(void 0===n?null:n)}}))}},{key:"_getPlayers",value:function(e,t){var n=e.objectStore("game_players");return new Promise((function(e,a){var r=[];n.index("game").openCursor(IDBKeyRange.only(t)).onsuccess=function(t){var n=t.target.result;n?(r.push(n.value),n.continue()):e(r)}}))}},{key:"_getRounds",value:function(e,t){var n=e.objectStore("rounds");return new Promise((function(e,a){var r=[];n.index("game").openCursor(IDBKeyRange.only(t)).onsuccess=function(t){var n=t.target.result;n?(r.push(n.value),n.continue()):e(r)}}))}},{key:"getGame",value:function(){var e=Object(j.a)(p.a.mark((function e(t){var n,a,r,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.idb.transaction(["games","game_players","rounds"],"readonly"),e.next=3,this._getGame(n,t);case 3:if(null!==(a=e.sent)){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,this._getPlayers(n,t);case 10:return r=e.sent,e.next=13,this._getRounds(n,t);case 13:return c=e.sent,e.abrupt("return",{game:a,players:r,rounds:c});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGame",value:function(){var e=this.idb.transaction(["games"],"readwrite").objectStore("games");return new Promise((function(t,n){e.add({name:"New Game",created:new Date,modified:new Date}).onsuccess=function(e){var n=e.target.result;t(n)}}))}},{key:"renameGame",value:function(e,t){var n=this.idb.transaction(["games"],"readwrite").objectStore("games");return new Promise((function(a,r){n.get(e).onsuccess=function(e){var c=e.target.result;c?(c.name=t,n.put(c).onsuccess=function(){a()}):r(new Error("No such game"))}}))}},{key:"removeGame",value:function(){var e=Object(j.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.idb.transaction(["games","game_players","rounds"],"readwrite"),e.next=3,new Promise((function(e,a){n.objectStore("game_players").index("game").openCursor(IDBKeyRange.only(t)).onsuccess=function(t){var n=t.target.result;n?(n.delete(),n.continue()):e(0)}}));case 3:return e.next=5,new Promise((function(e,a){n.objectStore("rounds").index("game").openCursor(IDBKeyRange.only(t)).onsuccess=function(t){var n=t.target.result;n?(n.delete(),n.continue()):e(0)}}));case 5:return e.next=7,new Promise((function(e,a){n.objectStore("games").delete(t).onsuccess=function(t){e(0)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setPlayers",value:function(){var e=Object(j.a)(p.a.mark((function e(t,n){var a,r,c,s,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.idb.transaction(["game_players"],"readwrite"),r=a.objectStore("game_players"),c=Object(m.a)(n),e.prev=3,o=p.a.mark((function e(){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.value,e.next=3,new Promise((function(e,a){r.add({game:t,name:n}),e(0)}));case 3:case"end":return e.stop()}}),e)})),c.s();case 6:if((s=c.n()).done){e.next=10;break}return e.delegateYield(o(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),c.e(e.t1);case 15:return e.prev=15,c.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setRound",value:function(e){var t=this.idb.transaction(["rounds"],"readwrite").objectStore("rounds");return new Promise((function(n,a){t.put(e).onsuccess=function(e){var t=e.target.result;n(t)}}))}}]),e}();function g(){return(g=Object(j.a)(p.a.mark((function e(t){var n,a,r,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.idb.transaction(["games","game_players","rounds"],"readwrite"),a=n.objectStore("games"),e.next=4,new Promise((function(e,t){a.openCursor().onsuccess=function(t){var n=t.target.result;e(!!n)}}));case 4:e.sent||(a.add({id:1,name:"Game 1",created:new Date("2021-11-27T23:32:27"),modified:new Date("2021-11-28T02:07:15")}),a.add({id:2,name:"Game 2",created:new Date("2021-11-29T01:45:39"),modified:new Date("2021-11-29T05:57:31")}),(r=n.objectStore("game_players")).add({id:1,game:1,name:"Remi"}),r.add({id:2,game:1,name:"Vicky"}),r.add({id:3,game:1,name:"Brian"}),(c=n.objectStore("rounds")).add({id:1,game:1,attacker:2,called:null,contract:"petite",attackOudlers:2,attackScore:48}),c.add({id:2,game:1,attacker:3,called:null,contract:"garde",attackOudlers:3,attackScore:45}),c.add({id:3,game:1,attacker:1,called:null,contract:"petite",attackOudlers:1,attackScore:49}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=new Promise((function(e,t){if(window.indexedDB){var n=window.indexedDB.open("scores",1);n.onerror=function(){alert("Couldn't use IndexedDB"),t(new Error("Couldn't use IndexedDB"))},n.onsuccess=function(t){var a=n.result;a.onerror=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.error;n&&alert("Database error: "+n)},function(e){return g.apply(this,arguments)}(new v(a)).then((function(){e(new v(a))}))},n.onupgradeneeded=function(e){if(console.log("Upgrading database:",e.oldVersion,"->",e.newVersion),1!==e.oldVersion){var t=e.target.result;b.forEach((function(e){var n=e.name,a=e.config,r=e.indexes,c=t.createObjectStore(n,a);r.forEach((function(e){return c.createIndex(e,e,{unique:!1})}))}))}}}else alert("Your browser doesn't support IndexedDB, can't store any data!")})),x=n(0),y=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={games:void 0},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(j.a)(p.a.mark((function t(){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.database.listGames();case 2:n=t.sent,e.setState({games:n});case 4:case"end":return t.stop()}}),t)})))()}},{key:"render",value:function(){var e=this.state.games;return e?Object(x.jsxs)("ul",{className:"games-list",children:[e.map((function(e){return Object(x.jsx)("li",{children:Object(x.jsx)(l.b,{to:"/".concat(e.id),children:e.name})},e.id)})),Object(x.jsx)("li",{className:"new-game",children:Object(x.jsx)(l.b,{to:"/new",children:"New game"})},"new")]}):Object(x.jsx)("p",{children:"Loading..."})}}]),n}(r.a.PureComponent),k=n(14);function w(e){return 1===e.attackOudlers?51:2===e.attackOudlers?41:3===e.attackOudlers?36:56}function S(e){return"garde"===e.contract?2:"garde sans"===e.contract?4:"garde contre"===e.contract?6:1}function I(e,t,n){return 5===t?e===n.attacker&&e===n.called?4:e===n.attacker?2:e===n.called?1:-1:e===n.attacker?t-1:-1}function C(e,t){var n=new Map;return e.forEach((function(e){n.set(e.id,0)})),t.forEach((function(t){var a=w(t),r=t.attackScore>=a,c=S(t),s=(25+Math.abs(t.attackScore-a))*(r?1:-1)*c;e.forEach((function(a){var r=s*I(a.id,e.length,t);n.set(a.id,n.get(a.id)+r)}))})),n}var P=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state=Object.assign({},e.round),a}return Object(i.a)(n,[{key:"changeContract",value:function(e){this.setState({contract:e})}},{key:"changeAttacker",value:function(e){this.setState({attacker:e})}},{key:"changeOudlers",value:function(e){this.setState({attackOudlers:Math.max(0,Math.min(3,e))})}},{key:"changeAttackScore",value:function(e){this.setState({attackScore:Math.max(0,Math.min(91,e))})}},{key:"changeDefenseScore",value:function(e){this.changeAttackScore(91-e)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.changeRound(this.state)}},{key:"render",value:function(){var e=this,t=this.props.players,n=this.state,a=n.attackScore,r=91-n.attackScore;return Object(x.jsxs)("form",{onSubmit:this.handleSubmit.bind(this),style:{marginTop:"2em"},children:["Contract: ",Object(x.jsxs)("select",{value:n.contract,onChange:function(t){return e.changeContract(t.target.value)},children:[Object(x.jsx)("option",{value:"petite",children:"Petite"}),Object(x.jsx)("option",{value:"garde",children:"Garde"}),Object(x.jsx)("option",{value:"garde sans",children:"Garde sans"}),Object(x.jsx)("option",{value:"garde contre",children:"Garde contre"})]})," ","Attack: ",Object(x.jsx)("select",{value:n.attacker,onChange:function(t){return e.changeAttacker(parseInt(t.target.value,10))},children:t.map((function(e){return Object(x.jsx)("option",{value:e.id,children:e.name},e.id)}))})," ","Oudlers: ",Object(x.jsx)("input",{type:"number",min:0,max:3,size:1,value:n.attackOudlers,onChange:function(t){return e.changeOudlers(parseInt(t.target.value,10))}})," ","Attack: ",Object(x.jsx)("input",{type:"number",min:0,max:91,size:2,value:a,onChange:function(t){return e.changeAttackScore(parseInt(t.target.value,10))}})," ","Defense: ",Object(x.jsx)("input",{type:"number",min:0,max:91,size:2,value:r,onChange:function(t){return e.changeDefenseScore(parseInt(t.target.value,10))}})," ",Object(x.jsx)("input",{type:"submit",value:"Set"})]})}}]),n}(r.a.PureComponent),N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.players,a=t.playersById,r=t.round,c=w(r),s=r.attackScore>=c,o=S(r),i=(25+Math.abs(r.attackScore-c))*(s?1:-1)*o;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("td",{children:Object(x.jsxs)("button",{className:"like-link",onClick:function(){return e.props.editRound(r.id)},children:[r.id,": ",a.get(r.attacker).name," ",r.contract,", ",r.attackScore>=c?"win +":"fail -",Math.abs(r.attackScore-c)]})},"round"),n.map((function(e){return Object(x.jsx)("td",{children:(t=e.id,i*I(t,n.length,r))},e.id);var t}))]})}}]),n}(r.a.PureComponent),D=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={gameInfo:void 0,removed:!1},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=parseInt(this.props.id,10);isNaN(t)?this.setState({gameInfo:null}):Object(j.a)(p.a.mark((function n(){var a,r,c,s,o,i,u;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.database.getGame(t);case 2:null===(a=n.sent)?e.setState({gameInfo:null}):(r=a.game,c=a.players,s=a.rounds,o=new Map,c.forEach((function(e){return o.set(e.id,e)})),i=new Map,s.forEach((function(e){return i.set(e.id,e)})),u=C(c,s),e.setState({gameInfo:{game:r,players:c,playersById:o,rounds:s,roundsById:i,scores:u,editing:void 0}}));case 4:case"end":return n.stop()}}),n)})))()}},{key:"rename",value:function(){var e=this,t=this.state.gameInfo;if(t){var n=t.game,a=window.prompt("New name",n.name);a&&a!==n.name&&Object(j.a)(p.a.mark((function r(){return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.props.database.renameGame(n.id,a);case 2:e.setState({gameInfo:Object(k.a)(Object(k.a)({},t),{},{game:Object(k.a)(Object(k.a)({},n),{},{name:a})})});case 3:case"end":return r.stop()}}),r)})))()}}},{key:"remove",value:function(){var e=this,t=this.state.gameInfo;if(t){var n=t.game;window.confirm("Are you sure you want to delete?")&&Object(j.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.database.removeGame(n.id);case 2:e.setState({removed:!0});case 3:case"end":return t.stop()}}),t)})))()}}},{key:"editRound",value:function(e){this.setState((function(t){var n=t.gameInfo;return n?{gameInfo:Object(k.a)(Object(k.a)({},n),{},{editing:e})}:{gameInfo:n}}))}},{key:"changeRound",value:function(){var e=Object(j.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.database.setRound(t);case 2:t.id=e.sent,this.setState((function(e){var n=e.gameInfo;if(n){var a,r=void 0;return n.rounds.forEach((function(e,n){e.id===t.id&&(r=n)})),a=void 0===r?n.rounds.concat([t]):n.rounds.slice(0,r).concat([t],n.rounds.slice(r+1)),{gameInfo:Object(k.a)(Object(k.a)({},n),{},{rounds:a,editing:void 0})}}return{gameInfo:n}}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.gameInfo;return t.removed?Object(x.jsx)(h.a,{to:"/"}):void 0===n?Object(x.jsx)("p",{children:"Loading..."}):null===n?Object(x.jsx)("p",{children:"No such game"}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{children:Object(x.jsx)(l.b,{to:"/",children:"Back to games"})}),Object(x.jsxs)("h1",{children:[n.game.name," ",Object(x.jsx)("button",{onClick:function(){return e.rename()},children:"(edit)"})," ",Object(x.jsx)("button",{onClick:function(){return e.remove()},children:"(delete)"})]}),Object(x.jsxs)("table",{className:"scores",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{className:"corner"}),n.players.map((function(e){return Object(x.jsx)("th",{children:e.name},e.id)}))]})}),Object(x.jsxs)("tbody",{children:[n.rounds.map((function(t){return Object(x.jsx)("tr",{children:Object(x.jsx)(N,{game:n.game,players:n.players,playersById:n.playersById,round:t,editRound:e.editRound.bind(e)})},t.id)})),Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:"TOTAL"},"header"),n.players.map((function(e){return Object(x.jsx)("th",{children:n.scores.get(e.id)},e.id)}))]},"total")]})]}),void 0!==n.editing?Object(x.jsx)(P,{round:n.roundsById.get(n.editing),players:n.players,changeRound:this.changeRound.bind(this)},n.editing):void 0]})}}]),n}(r.a.PureComponent),G=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={gameId:void 0},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(j.a)(p.a.mark((function t(){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.database.createGame();case 2:n=t.sent,e.setState({gameId:n});case 4:case"end":return t.stop()}}),t)})))()}},{key:"render",value:function(){var e=this.state.gameId;return void 0===e?Object(x.jsx)("p",{children:"Creating..."}):Object(x.jsx)(h.a,{to:"/set-players/".concat(e)})}}]),n}(r.a.PureComponent),B=n(27),R=n(28),M=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={info:void 0,playerNames:[],playerIdGen:0,ready:!1},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=parseInt(this.props.id,10);isNaN(t)?this.setState({info:null}):Object(j.a)(p.a.mark((function n(){var a;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.database.getGame(t);case 2:null===(a=n.sent)?e.setState({info:null}):e.setState({info:a});case 4:case"end":return n.stop()}}),n)})))()}},{key:"changed",value:function(e,t){null===e?this.setState((function(e){return{playerNames:[].concat(Object(R.a)(e.playerNames),[[e.playerIdGen,t]]),playerIdGen:e.playerIdGen+1}})):this.setState((function(n){return{playerNames:n.playerNames.slice(0,e).concat([[n.playerNames[e][0],t]],n.playerNames.slice(e+1))}}))}},{key:"blurred",value:function(e,t){0===t.length&&this.setState((function(t){return{playerNames:t.playerNames.slice(0,e).concat(t.playerNames.slice(e+1))}}))}},{key:"commit",value:function(){var e=Object(j.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.info)){e.next=5;break}return e.next=4,this.props.database.setPlayers(t.game.id,this.state.playerNames.map((function(e){return e[1]})));case 4:this.setState({ready:!0});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.info,a=t.playerNames,r=t.playerIdGen,c=t.ready;if(void 0===n)return Object(x.jsx)("p",{children:"Loading..."});if(null===n)return Object(x.jsx)("p",{children:"No such game"});if(c||n.rounds.length>0||n.players.length>0)return Object(x.jsx)(h.a,{to:"/".concat(n.game.id)});var s=[];return a.forEach((function(t,n){var a=Object(B.a)(t,2),r=a[0],c=a[1];s.push(Object(x.jsxs)("tr",{children:[Object(x.jsxs)("td",{children:["index=",n," id=",r]}),Object(x.jsx)("td",{children:Object(x.jsx)("input",{type:"text",value:c,onChange:function(t){return e.changed(n,t.target.value)},onBlur:function(t){return e.blurred(n,t.target.value)}})})]},r))})),a.length<5&&s.push(Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:"(new)"}),Object(x.jsx)("td",{children:Object(x.jsx)("input",{type:"text",value:"",onChange:function(t){return e.changed(null,t.target.value)}})})]},r)),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("h1",{children:"Set player names"}),Object(x.jsx)("table",{className:"players",children:Object(x.jsx)("tbody",{children:s})}),Object(x.jsx)("button",{onClick:function(){return e.commit()},disabled:a.length<3,children:"Play!"})]})}}]),n}(r.a.PureComponent);function _(e){return Object(x.jsx)(l.a,{children:e.children})}var E=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={database:void 0},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;O.then((function(t){e.setState({database:t})}))}},{key:"render",value:function(){var e=this.state.database;return void 0===e?Object(x.jsx)("p",{children:"Loading..."}):Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(_,{children:Object(x.jsxs)(h.d,{children:[Object(x.jsx)(h.b,{path:"/new",render:function(){return Object(x.jsx)(G,{database:e})}}),Object(x.jsx)(h.b,{path:"/set-players/:game",render:function(t){return Object(x.jsx)(M,{id:t.match.params.game,database:e})}}),Object(x.jsx)(h.b,{path:"/:game",render:function(t){return Object(x.jsx)(D,{id:t.match.params.game,database:e})}}),Object(x.jsx)(h.b,{path:"/",render:function(){return Object(x.jsx)(y,{database:e})}})]})})})}}]),n}(r.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,43)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};s.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(E,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),A()}},[[42,1,2]]]);
//# sourceMappingURL=main.f87fbf34.chunk.js.map